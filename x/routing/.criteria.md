# PromiseGrid Messaging Fitness Criteria

This document describes the fitness criteria and design rationale for
a simple, efficient, and easily routable messaging protocol meeting
PromiseGrid’s requirements. The proposed design emphasizes security,
resource–awareness, and formal verifiability, while keeping the
implementation lightweight (suitable even for constrained devices such
as Cortex‑M0 or ESP32). We also compare a “CID list” approach (using a
‘grid’ tag, a length field, a list of CIDs, and a payload) with
alternative designs such as hierarchical topic models and graph
fragment messages.

---

### Routing and Processing

- **Routing Simplicity:**  
  The single CID (or small list) is used as the key for routing. A device maintains a simple lookup table and uses a Bloom filter plus a small fixed‐size prefix to achieve O(1) lookups. This ensures fast, predictable latency.
  
- **Resource Enforcement:**  
  The header includes explicit numeric limits (e.g. CPU, memory) so that the kernel can quickly check whether the sender has enough “credit”. This reduces the risk of any one agent “abusing” hardware resources.
  
- **Promise-Orientation:**  
  By optionally including a precondition and postcondition CID within the payload, the message naturally extends to a promise chain or scenario – that is, the node “remembers” that fulfilling the promise (such as completing a CPU‐intensive task) will lead to a new state. This model is compatible with future extensions for formal scenario tree verification.

- **Formal Verification:**  
  The simple “grid”,length,CID list,payload format is easy to model in TLA+ as a state machine, facilitating proofs of resource invariants and correct promise resolution. The design is compatible with seL4-style IPC and capability models, ensuring robust memory and resource isolation.

---

## 3. Comparison with Alternative Designs

### Hierarchical Topics
- **Pros:**
  - Rich semantic structure allows for topics such as "domain/location/device".
  - Wildcard subscriptions and finer-grained access control.
- **Cons:**
  - Requires more complex processing (e.g., constructing Merkle proofs for CID concatenation).
  - Higher overhead for dynamic addition/removal of subtopics.
  - Complexity is not needed when a single-level CID provides sufficient routing guarantee, especially on constrained hardware.

### Graph Fragment Messages
- **Pros:**
  - Expressive; can represent a fragment of a workflow as nodes and edges.
  - Potential to merge multiple state transitions in one message.
- **Cons:**
  - Higher routing complexity (O(n) comparisons) and increased storage overhead.
  - Verification becomes more difficult (exponential state growth), which is unsuitable for a system expected to run on devices with very limited resources.
  - Not as “promise‐oriented” as the simple state–transition CID model.

### Hybrid/Promise Chain Models
- **Pros:**
  - Directly encodes promise semantics (old state, probability, promise action, new state), supporting dynamic workflows.
  - Enables formal step‐by‐step verification of promise fulfillment.
- **Cons:**
  - For simple routing needs the extra complexity is unnecessary.
  - Can be implemented by using a single routing CID (the old state) and a promise chain in the payload.
  - The extra values increase message length and parsing overhead.

**Conclusion:**  
Given the requirements for low overhead, ease of routing, rapid formal verification, and adequate support for promise tracking and resource enforcement, the simple “CID list” format (using a single or small list of CIDs) best meets the criteria. It is easy to implement, has low processing cost on constrained devices, and scales well down to microcontrollers. More elaborate hierarchical or graph–based formats may be considered for upper-layer applications but for the PromiseGrid kernel the simple design is optimal.

---

## 4. Summary of Fitness Criteria

- **Simplicity and Minimal Overhead:**  
  A single CID list message (protocol tag, fixed length, one or few CIDs, and a compact payload) keeps processing lightweight.
- **Resource Awareness:**  
  Explicit resource budgets in the header let the kernel throttle or drop messages from over–consuming agents, while the promise fields in the payload ensure value creation is rewarded.
- **Security and Accountability:**  
  Using content–addressed CIDs guarantees integrity and supports capability token semantics; messages can be cryptographically verified.
- **Formal Verification:**  
  The flat, state-based CID list message format is straightforward to model in TLA+ and fits within seL4’s capability framework, easing formal proofs of safety, liveness, and resource constraints.
- **Promise Orientation:**  
  Optional precondition and postcondition fields allow the extension of the design into a promise chain or scenario tree, supporting dynamic state transitions based on agent promises.

This design, with its careful use of a “grid” tag, fixed length, CID list, and payload, meets PromiseGrid’s criteria while facilitating efficient routing, robust security, and formal verification. Future enhancements may layer in hierarchical features or elaborate promise chaining as needed, but the recommended design offers an optimal starting point for scalable, resource–aware, promise–oriented messaging.
